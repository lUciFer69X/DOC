import React, { useState, useEffect, useMemo } from 'react';
import { 
  Search, 
  Pill, 
  GraduationCap, 
  HeartPulse, 
  Microscope, 
  Calculator, 
  Syringe, 
  StickyNote, 
  Save, 
  ChevronDown, 
  ChevronLeft, 
  Info, 
  AlertTriangle, 
  Baby, 
  Weight, 
  CalendarHeart,
  Menu,
  X,
  Activity,
  Droplets,
  Thermometer,
  Stethoscope
} from 'lucide-react';

// --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---

const DRUG_DB = [
  { name: "Panadol / Abimol", generic: "Paracetamol", use: "Ù…Ø³ÙƒÙ† Ù„Ù„Ø£Ù„Ù… ÙˆØ®Ø§ÙØ¶ Ù„Ù„Ø­Ø±Ø§Ø±Ø© (Ø¢Ù…Ù† Ù„Ù„Ø­ÙˆØ§Ù…Ù„)", dose: "Ù‚Ø±Øµ 500Ù…Ø¬Ù… / 6-8 Ø³Ø§Ø¹Ø§Øª", warn: "Ø¢Ù…Ù† Ø¬Ø¯Ø§Ù‹ØŒ ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªØªØ¬Ø§ÙˆØ²ÙŠ 4 Ø¬Ù… ÙŠÙˆÙ…ÙŠØ§Ù‹.", type: "otc" },
  { name: "Cataflam / Voltaren", generic: "Diclofenac Pot/Sod", use: "Ù…Ø³ÙƒÙ† Ù‚ÙˆÙŠ ÙˆÙ…Ø¶Ø§Ø¯ Ù„Ù„Ø§Ù„ØªÙ‡Ø§Ø¨ (Ø¹Ø¸Ø§Ù…/Ø£Ø³Ù†Ø§Ù†)", dose: "50 Ù…Ø¬Ù… / 8-12 Ø³Ø§Ø¹Ø©", warn: "Ù…Ù…Ù†ÙˆØ¹ Ù„Ù…Ø±Ø¶Ù‰ Ù‚Ø±Ø­Ø© Ø§Ù„Ù…Ø¹Ø¯Ø©ØŒ Ø§Ù„ÙƒÙ„Ù‰ØŒ ÙˆØ§Ù„Ø¶ØºØ· Ø§Ù„Ø¹Ø§Ù„ÙŠ.", type: "nsaid" },
  { name: "Brufen", generic: "Ibuprofen", use: "Ù…Ø³ÙƒÙ† ÙˆÙ…Ø¶Ø§Ø¯ Ø§Ù„ØªÙ‡Ø§Ø¨ ÙˆØ®Ø§ÙØ¶ Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„", dose: "400 Ù…Ø¬Ù… / 8 Ø³Ø§Ø¹Ø§Øª", warn: "ÙŠØ¤Ø®Ø° Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„ Ù„ØªØ¬Ù†Ø¨ Ø£Ù„Ù… Ø§Ù„Ù…Ø¹Ø¯Ø©.", type: "nsaid" },
  { name: "Augmentin / Hibiotic", generic: "Amoxicillin + Clavulanic", use: "Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ ÙˆØ§Ø³Ø¹ Ø§Ù„Ù…Ø¬Ø§Ù„ (ØªÙ†ÙØ³ÙŠ/Ù…Ø³Ø§Ù„Ùƒ)", dose: "1 Ø¬Ù… / 12 Ø³Ø§Ø¹Ø©", warn: "Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ø¥Ø³Ù‡Ø§Ù„. Ù…Ù…Ù†ÙˆØ¹ Ù„Ù…Ù† Ù„Ø¯ÙŠÙ‡Ù… Ø­Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ù†Ø³Ù„ÙŠÙ†.", type: "antibiotic" },
  { name: "Zithromax / Zisrocin", generic: "Azithromycin", use: "Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ (ØªÙ†ÙØ³ÙŠ Ø¹Ù„ÙˆÙŠ/ÙƒÙˆØ±ÙˆÙ†Ø§)", dose: "500 Ù…Ø¬Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ (3 Ø£ÙŠØ§Ù…)", warn: "ÙŠØ¤Ø®Ø° Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„ Ø¨Ø³Ø§Ø¹Ø© Ø£Ùˆ Ø¨Ø¹Ø¯Ù‡ Ø¨Ø³Ø§Ø¹ØªÙŠÙ†.", type: "antibiotic" },
  { name: "Flagyl / Amrizole", generic: "Metronidazole", use: "Ù…Ø·Ù‡Ø± Ù…Ø¹ÙˆÙŠ (Ù„Ù„Ø¥Ø³Ù‡Ø§Ù„ ÙˆØ§Ù„Ø£Ù…ÙŠØ¨Ø§)", dose: "500 Ù…Ø¬Ù… / 8 Ø³Ø§Ø¹Ø§Øª", warn: "ÙŠØ³Ø¨Ø¨ Ø·Ø¹Ù… Ù…Ø¹Ø¯Ù†ÙŠ Ø¨Ø§Ù„ÙÙ… ÙˆØªÙ„ÙˆÙ† Ø§Ù„Ø¨ÙˆÙ„.", type: "antibiotic" },
  { name: "Antodine / Famotin", generic: "Famotidine", use: "Ù„Ù„Ø­Ù…ÙˆØ¶Ø© ÙˆØ§Ø±ØªØ¬Ø§Ø¹ Ø§Ù„Ù…Ø±ÙŠØ¡", dose: "40 Ù…Ø¬Ù… Ù…Ø³Ø§Ø¡Ù‹", warn: "Ø¢Ù…Ù† Ù†Ø³Ø¨ÙŠØ§Ù‹.", type: "git" },
  { name: "Controloc / Zurcal", generic: "Pantoprazole", use: "Ù„Ù‚Ø±Ø­Ø© Ø§Ù„Ù…Ø¹Ø¯Ø© ÙˆØ§Ù„Ø§Ø±ØªØ¬Ø§Ø¹ Ø§Ù„Ø´Ø¯ÙŠØ¯", dose: "40 Ù…Ø¬Ù… Ù‚Ø¨Ù„ Ø§Ù„ÙØ·Ø§Ø± Ø¨Ù†ØµÙ Ø³Ø§Ø¹Ø©", warn: "ÙŠØ³ØªØ®Ø¯Ù… Ù„ÙØªØ±Ø§Øª Ø·ÙˆÙŠÙ„Ø© Ø¨Ø£Ù…Ø§Ù†.", type: "git" },
  { name: "Visceralgine", generic: "Tiemonium", use: "Ù„Ù„Ù…ØºØµ ÙˆØ§Ù„ØªÙ‚Ù„ØµØ§Øª (Ø§Ù„Ø¯ÙˆØ±Ø©/Ø§Ù„Ù‚ÙˆÙ„ÙˆÙ†)", dose: "Ù‚Ø±Øµ 3 Ù…Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…", warn: "Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ø¬ÙØ§Ù Ø¨Ø§Ù„ÙÙ….", type: "spasm" },
  { name: "Neuril / Valinil", generic: "Diazepam", use: "Ù…Ù‡Ø¯Ø¦ ÙˆÙ…Ø¶Ø§Ø¯ Ù„Ù„ØªØ´Ù†Ø¬Ø§Øª (Ø·ÙˆØ§Ø±Ø¦)", dose: "ÙˆØ±ÙŠØ¯ Ø¨Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯ Ø¬Ø¯Ø§Ù‹", warn: "âš ï¸ Ø¬Ø¯ÙˆÙ„ Ù…Ø®Ø¯Ø±Ø§Øª! Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ ØªÙˆÙ‚Ù Ø§Ù„ØªÙ†ÙØ³ (Apnea).", type: "cns" },
  { name: "Lasix", generic: "Furosemide", use: "Ù…Ø¯Ø± Ù„Ù„Ø¨ÙˆÙ„ (Ø¶ØºØ· Ø¹Ø§Ù„ÙŠ/ØªÙˆØ±Ù…)", dose: "40 Ù…Ø¬Ù… ØµØ¨Ø§Ø­Ø§Ù‹", warn: "ÙŠÙ‚Ù„Ù„ Ø§Ù„Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ… ÙˆÙŠØ³Ø¨Ø¨ ÙƒØ«Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙ„.", type: "cvs" },
  { name: "Capoten", generic: "Captopril", use: "Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø±ØªÙØ¹ (ØªØ­Øª Ø§Ù„Ù„Ø³Ø§Ù†)", dose: "25 Ù…Ø¬Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…", warn: "ÙŠØ³Ø¨Ø¨ ÙƒØ­Ø© Ù†Ø§Ø´ÙØ©.", type: "cvs" },
  { name: "Adrenaline", generic: "Epinephrine", use: "Ø¥Ù†Ø¹Ø§Ø´ Ø§Ù„Ù‚Ù„Ø¨ / ØµØ¯Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©", dose: "Ø£Ù…Ø¨ÙˆÙ„ (Ø·ÙˆØ§Ø±Ø¦ ÙÙ‚Ø·)", warn: "ÙŠØ³Ø¨Ø¨ ØªØ³Ø§Ø±Ø¹ Ø´Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨.", type: "emergency" },
  { name: "Plavix", generic: "Clopidogrel", use: "Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯Ù… (Ù„Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„Ø¬Ù„Ø·Ø§Øª)", dose: "75 Ù…Ø¬Ù… ÙŠÙˆÙ…ÙŠØ§Ù‹", warn: "Ø®Ø·Ø± Ø§Ù„Ù†Ø²ÙŠÙØŒ ÙŠÙˆÙ‚Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª.", type: "cvs" },
  { name: "Concor", generic: "Bisoprolol", use: "ØªÙ†Ø¸ÙŠÙ… Ø¶Ø±Ø¨Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„Ø¶ØºØ·", dose: "2.5 - 10 Ù…Ø¬Ù… ØµØ¨Ø§Ø­Ø§Ù‹", warn: "âš ï¸ Ø®Ø·Ø± Ø¬Ø¯Ø§Ù‹ Ø¥ÙŠÙ‚Ø§ÙÙ‡ ÙØ¬Ø£Ø©.", type: "cvs" }
];

const TERMINOLOGY = [
  { term: "-itis", meaning: "Ø§Ù„ØªÙ‡Ø§Ø¨ (Inflammation)" },
  { term: "Hyper-", meaning: "Ø¹Ø§Ù„ÙŠ / Ø²ÙŠØ§Ø¯Ø© (High)" },
  { term: "Hypo-", meaning: "Ù…Ù†Ø®ÙØ¶ (Low)" },
  { term: "Tachy-", meaning: "Ø³Ø±ÙŠØ¹ (Fast)" },
  { term: "Brady-", meaning: "Ø¨Ø·ÙŠØ¡ (Slow)" },
  { term: "Dys-", meaning: "ØµØ¹ÙˆØ¨Ø© / Ø®Ù„Ù„ (Difficulty)" }
];

const SUFFIXES = [
  { term: "-lol", meaning: "Beta Blockers (Ù„Ù„Ø¶ØºØ· ÙˆØ§Ù„Ù‚Ù„Ø¨)" },
  { term: "-pril", meaning: "ACE Inhibitors (Ù„Ù„Ø¶ØºØ·)" },
  { term: "-sartan", meaning: "ARBs (Ù„Ù„Ø¶ØºØ·)" },
  { term: "-prazole", meaning: "Proton Pump Inhibitors (Ù„Ù„Ù…Ø¹Ø¯Ø©)" },
  { term: "-statin", meaning: "Cholesterol drugs (Ù„Ù„Ø¯Ù‡ÙˆÙ†)" },
  { term: "-cillin", meaning: "Penicillins (Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ)" },
  { term: "-floxacin", meaning: "Quinolones (Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ)" }
];

// --- Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ---

const SectionTitle = ({ icon: Icon, title, color = "text-purple-600" }) => (
  <div className="flex items-center gap-3 mb-6 px-2">
    <div className={`p-2 rounded-lg bg-opacity-10 ${color.replace('text-', 'bg-')}`}>
      <Icon size={24} className={color} />
    </div>
    <h2 className="text-xl font-bold text-slate-800">{title}</h2>
  </div>
);

const Card = ({ children, className = "", onClick }) => (
  <div 
    onClick={onClick}
    className={`bg-white rounded-2xl shadow-sm border border-slate-100 p-5 transition-all duration-200 ${onClick ? 'cursor-pointer hover:shadow-md hover:scale-[1.01] active:scale-[0.98]' : ''} ${className}`}
  >
    {children}
  </div>
);

const Badge = ({ children, type }) => {
  const colors = {
    otc: "bg-green-100 text-green-700",
    nsaid: "bg-orange-100 text-orange-700",
    antibiotic: "bg-blue-100 text-blue-700",
    emergency: "bg-red-100 text-red-700",
    default: "bg-slate-100 text-slate-700"
  };
  return (
    <span className={`px-2.5 py-1 rounded-md text-xs font-bold ${colors[type] || colors.default}`}>
      {children}
    </span>
  );
};

// --- Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---

export default function DrBiboApp() {
  const [activeTab, setActiveTab] = useState('home'); // home, drugs, study, emergency, labs, calcs, nursing, notes
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedDrug, setSelectedDrug] = useState(null);
  const [notes, setNotes] = useState('');
  const [showSaveMsg, setShowSaveMsg] = useState(false);

  // States for Calculators
  const [calcPed, setCalcPed] = useState({ w: '', d: '', c: '', res: null });
  const [calcBMI, setCalcBMI] = useState({ w: '', h: '', res: null, status: '' });
  const [calcEDD, setCalcEDD] = useState({ lmp: '', res: null });

  // Load Notes on mount
  useEffect(() => {
    const saved = localStorage.getItem('bibo_notes');
    if (saved) setNotes(saved);
  }, []);

  const handleSaveNotes = () => {
    localStorage.setItem('bibo_notes', notes);
    setShowSaveMsg(true);
    setTimeout(() => setShowSaveMsg(false), 3000);
  };

  const filteredDrugs = useMemo(() => {
    if (!searchQuery) return DRUG_DB;
    const q = searchQuery.toLowerCase();
    return DRUG_DB.filter(d => 
      d.name.toLowerCase().includes(q) || 
      d.generic.toLowerCase().includes(q) || 
      d.use.includes(q)
    );
  }, [searchQuery]);

  // Auto switch to drugs tab on search
  useEffect(() => {
    if (searchQuery && activeTab !== 'drugs') {
      setActiveTab('drugs');
    }
  }, [searchQuery]);

  const renderContent = () => {
    switch (activeTab) {
      case 'drugs':
        return (
          <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={Pill} title="Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© (Pharmacology)" color="text-purple-600" />
            {filteredDrugs.length === 0 ? (
              <div className="text-center py-12 text-slate-400">
                <Search size={48} className="mx-auto mb-4 opacity-20" />
                <p>Ù…ÙÙŠØ´ Ø¯ÙˆØ§Ø¡ Ø¨Ø§Ù„Ø§Ø³Ù… Ø¯Ù‡ ÙŠØ§ Ø¯ÙƒØªÙˆØ±Ø© ğŸ¤·â€â™‚ï¸</p>
              </div>
            ) : (
              filteredDrugs.map((drug, idx) => (
                <Card key={idx} onClick={() => setSelectedDrug(drug)} className="border-r-4 border-r-purple-500">
                  <div className="flex justify-between items-start">
                    <div>
                      <h3 className="font-bold text-lg text-purple-900">{drug.name}</h3>
                      <p className="text-sm text-slate-500 font-medium mb-2">{drug.generic}</p>
                      <Badge type={drug.type || 'default'}>{drug.use.split(' ')[0]}</Badge>
                    </div>
                    <ChevronLeft className="text-slate-300" />
                  </div>
                </Card>
              ))
            )}
          </div>
        );

      case 'study':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={GraduationCap} title="Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ (Study)" color="text-blue-600" />
            
            {/* Terminology */}
            <Card>
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <Activity size={18} className="text-blue-500" /> Ù…ØµØ·Ù„Ø­Ø§Øª Ø·Ø¨ÙŠØ©
              </h3>
              <div className="overflow-hidden rounded-xl border border-slate-100">
                <table className="w-full text-sm">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="p-3 text-right">Ø§Ù„Ù…ØµØ·Ù„Ø­</th>
                      <th className="p-3 text-right">Ø§Ù„Ù…Ø¹Ù†Ù‰</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-100">
                    {TERMINOLOGY.map((t, i) => (
                      <tr key={i}>
                        <td className="p-3 font-semibold text-blue-700 dir-ltr text-left">{t.term}</td>
                        <td className="p-3 text-slate-600">{t.meaning}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </Card>

            {/* Suffixes */}
            <Card>
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <Pill size={18} className="text-purple-500" /> Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©
              </h3>
              <ul className="space-y-3">
                {SUFFIXES.map((s, i) => (
                  <li key={i} className="flex items-center gap-3 text-sm p-2 bg-slate-50 rounded-lg">
                    <span className="font-bold text-purple-600 dir-ltr min-w-[80px] text-center">{s.term}</span>
                    <span className="text-slate-600">{s.meaning}</span>
                  </li>
                ))}
              </ul>
            </Card>
          </div>
        );

      case 'emergency':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={HeartPulse} title="Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦" color="text-red-600" />
            
            <div className="bg-red-50 rounded-2xl border border-red-100 overflow-hidden">
              <div className="bg-red-600 text-white p-4 font-bold flex items-center gap-2">
                <HeartPulse size={20} /> ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ù„Ø¨ (CPR)
              </div>
              <div className="p-5 text-slate-700 space-y-2 text-sm">
                <p>1. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù† Ø«Ù… Ø§Ù„ÙˆØ¹ÙŠ (Ù‡Ø²ÙŠ Ø§Ù„Ù…Ø±ÙŠØ¶).</p>
                <p>2. Ø§ØªØµÙ„ÙŠ Ø¨Ø§Ù„Ø¥Ø³Ø¹Ø§Ù / Ø§Ø·Ù„Ø¨ÙŠ Code Blue.</p>
                <p>3. ØªØ­Ø³Ø³ÙŠ Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ø³Ø¨Ø§ØªÙŠ (Carotid) Ù„Ù…Ø¯Ø© 10 Ø«ÙˆØ§Ù†.</p>
                <p className="font-bold text-red-600 bg-red-100 p-2 rounded">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¨Ø¶ØŸ Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„Ø¶ØºØ·Ø§Øª ÙÙˆØ±Ø§Ù‹.</p>
                <ul className="list-disc list-inside pr-2 text-slate-600">
                  <li>Ù…Ø¹Ø¯Ù„: 100-120 Ø¶ØºØ·Ø©/Ø¯Ù‚ÙŠÙ‚Ø©.</li>
                  <li>Ø¹Ù…Ù‚: 5-6 Ø³Ù….</li>
                  <li>Ù†Ø³Ø¨Ø© 30 Ø¶ØºØ·Ø© : 2 Ù†ÙØ³.</li>
                </ul>
              </div>
            </div>

            <div className="bg-amber-50 rounded-2xl border border-amber-100 overflow-hidden">
              <div className="bg-amber-500 text-white p-4 font-bold flex items-center gap-2">
                <AlertTriangle size={20} /> ØµØ¯Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© (Anaphylaxis)
              </div>
              <div className="p-5">
                <p className="text-sm text-slate-600 mb-4">
                  <b>âš ï¸ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶:</b> ØªÙˆØ±Ù… Ø´ÙØ§ÙŠÙØŒ Ø¶ÙŠÙ‚ ØªÙ†ÙØ³ØŒ Ø·ÙØ­ Ø¬Ù„Ø¯ÙŠØŒ Ù‡Ø¨ÙˆØ· Ø¶ØºØ·.
                </p>
                <div className="space-y-2 bg-white p-3 rounded-xl border border-amber-100">
                  <p className="text-amber-600 font-bold text-sm">Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„ÙÙˆØ±ÙŠ (Life Saving):</p>
                  <ol className="list-decimal list-inside text-sm text-slate-700 space-y-1">
                    <li><span className="font-bold">Adrenaline:</span> Ø£Ù…Ø¨ÙˆÙ„ Ø¹Ø¶Ù„ ÙÙˆØ±Ø§Ù‹ (Ø¨Ø¯ÙˆÙ† ØªØ®ÙÙŠÙ Ù„Ù„ÙƒØ¨Ø§Ø±).</li>
                    <li><span className="font-bold">Avil:</span> (Antihistamine) Ø£Ù…Ø¨ÙˆÙ„ ÙˆØ±ÙŠØ¯/Ø¹Ø¶Ù„.</li>
                    <li><span className="font-bold">Solu-Cortef:</span> 100mg ÙˆØ±ÙŠØ¯ Ø¨Ø¨Ø·Ø¡.</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        );

      case 'labs':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={Microscope} title="Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© (Labs)" color="text-teal-600" />
            
            {[
              { title: "ØµÙˆØ±Ø© Ø§Ù„Ø¯Ù… (CBC)", icon: Activity, color: "text-red-500", data: [
                { k: "WBCs", v: "4k - 11k" }, { k: "Hb (Male)", v: "13.5 - 17.5" }, { k: "Hb (Female)", v: "12.0 - 15.5" }, { k: "PLT", v: "150k - 450k" }
              ]},
              { title: "ÙˆØ¸Ø§Ø¦Ù ÙƒÙ„Ù‰ ÙˆÙƒØ¨Ø¯", icon: Thermometer, color: "text-orange-500", data: [
                { k: "Creatinine", v: "0.6 - 1.2" }, { k: "Urea", v: "15 - 45" }, { k: "ALT/AST", v: "Up to 40" }
              ]},
              { title: "Ø§Ù„Ø´ÙˆØ§Ø±Ø¯ (Electrolytes)", icon: ZapIcon, color: "text-yellow-500", data: [
                { k: "Sodium (Na)", v: "135 - 145" }, { k: "Potassium (K)", v: "3.5 - 5.0" }, { k: "Calcium", v: "8.5 - 10.2" }
              ]}
            ].map((section, i) => (
              <Card key={i}>
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <section.icon size={18} className={section.color} /> {section.title}
                </h3>
                <div className="grid grid-cols-2 gap-3">
                  {section.data.map((item, idx) => (
                    <div key={idx} className="bg-slate-50 p-2 rounded-lg text-center">
                      <div className="text-xs text-slate-400 font-bold uppercase">{item.k}</div>
                      <div className="font-mono text-slate-700 font-semibold dir-ltr">{item.v}</div>
                    </div>
                  ))}
                </div>
              </Card>
            ))}
          </div>
        );

      case 'calcs':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={Calculator} title="Ø­Ø§Ø³Ø¨Ø§Øª Ø·Ø¨ÙŠØ©" color="text-indigo-600" />
            
            {/* Pediatric Dose */}
            <Card>
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <Baby size={20} className="text-pink-500" /> Ø¬Ø±Ø¹Ø© Ø´Ø±Ø§Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„
              </h3>
              <div className="space-y-3">
                <input type="number" placeholder="ÙˆØ²Ù† Ø§Ù„Ø·ÙÙ„ (ÙƒØ¬Ù…)" className="w-full p-3 bg-slate-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-200" onChange={e => setCalcPed({...calcPed, w: e.target.value})} />
                <div className="flex gap-3">
                  <input type="number" placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø© (mg/kg)" className="w-1/2 p-3 bg-slate-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-200" onChange={e => setCalcPed({...calcPed, d: e.target.value})} />
                  <input type="number" placeholder="Ø§Ù„ØªØ±ÙƒÙŠØ² (mg/5ml)" className="w-1/2 p-3 bg-slate-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-200" onChange={e => setCalcPed({...calcPed, c: e.target.value})} />
                </div>
                <button 
                  onClick={() => {
                    const res = (parseFloat(calcPed.w) * parseFloat(calcPed.d) * 5) / parseFloat(calcPed.c);
                    setCalcPed({...calcPed, res: isNaN(res) ? null : res.toFixed(1)});
                  }}
                  className="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition"
                >
                  Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©
                </button>
                {calcPed.res && (
                  <div className="bg-green-100 text-green-800 p-3 rounded-xl text-center font-bold">
                    Ø§Ù„Ø¬Ø±Ø¹Ø©: {calcPed.res} Ø³Ù… <span className="text-xs font-normal">ÙƒÙ„ Ù…Ø±Ø©</span>
                  </div>
                )}
              </div>
            </Card>

            {/* BMI */}
            <Card>
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <Weight size={20} className="text-teal-500" /> Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù… (BMI)
              </h3>
              <div className="flex gap-3 mb-3">
                <input type="number" placeholder="Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)" className="w-1/2 p-3 bg-slate-50 rounded-xl" onChange={e => setCalcBMI({...calcBMI, w: e.target.value})} />
                <input type="number" placeholder="Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)" className="w-1/2 p-3 bg-slate-50 rounded-xl" onChange={e => setCalcBMI({...calcBMI, h: e.target.value})} />
              </div>
              <button 
                onClick={() => {
                  const hM = parseFloat(calcBMI.h) / 100;
                  const bmi = parseFloat(calcBMI.w) / (hM * hM);
                  let status = "";
                  if(bmi < 18.5) status = "Ù†Ø­Ø§ÙØ©";
                  else if(bmi < 25) status = "ÙˆØ²Ù† Ù…Ø«Ø§Ù„ÙŠ";
                  else if(bmi < 30) status = "ÙˆØ²Ù† Ø²Ø§Ø¦Ø¯";
                  else status = "Ø³Ù…Ù†Ø©";
                  setCalcBMI({...calcBMI, res: isNaN(bmi) ? null : bmi.toFixed(1), status});
                }}
                className="w-full py-3 bg-teal-600 text-white rounded-xl font-bold hover:bg-teal-700 transition"
              >
                Ø§Ø­Ø³Ø¨ BMI
              </button>
              {calcBMI.res && (
                <div className="mt-3 bg-slate-800 text-white p-3 rounded-xl text-center">
                  <div className="text-2xl font-bold">{calcBMI.res}</div>
                  <div className="text-sm opacity-80">{calcBMI.status}</div>
                </div>
              )}
            </Card>
          </div>
        );

      case 'nursing':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={Syringe} title="Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶" color="text-sky-600" />
            
            <Card>
              <h3 className="font-bold text-slate-800 mb-4 text-center">Ø¯Ù„ÙŠÙ„ Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù†ÙŠÙˆÙ„Ø§</h3>
              <div className="grid grid-cols-3 gap-3">
                {[
                  { c: "bg-yellow-400 text-black", t: "Yellow", g: "24G" },
                  { c: "bg-blue-500 text-white", t: "Blue", g: "22G" },
                  { c: "bg-pink-500 text-white", t: "Pink", g: "20G" },
                  { c: "bg-green-500 text-white", t: "Green", g: "18G" },
                  { c: "bg-gray-400 text-white", t: "Grey", g: "16G" },
                  { c: "bg-orange-500 text-white", t: "Orange", g: "14G" },
                ].map((can, i) => (
                  <div key={i} className={`${can.c} p-3 rounded-xl text-center shadow-sm`}>
                    <div className="font-bold text-sm">{can.t}</div>
                    <div className="text-xs opacity-90">{can.g}</div>
                  </div>
                ))}
              </div>
            </Card>

            <Card>
              <h3 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                <Droplets size={20} className="text-sky-500" /> Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø­Ø§Ù„ÙŠÙ„
              </h3>
              <div className="space-y-3 text-sm">
                <div className="p-3 bg-sky-50 rounded-lg border border-sky-100">
                  <span className="font-bold text-sky-700 block mb-1">Isotonic (Ù…ØªØ¹Ø§Ø¯Ù„)</span>
                  <span className="text-slate-600">N.Saline 0.9% / Ringer: Ù„Ø±ÙØ¹ Ø§Ù„Ø¶ØºØ·ØŒ Ø§Ù„Ø¬ÙØ§ÙØŒ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª.</span>
                </div>
                <div className="p-3 bg-blue-50 rounded-lg border border-blue-100">
                  <span className="font-bold text-blue-700 block mb-1">Hypotonic (Ù…Ø®ÙÙ)</span>
                  <span className="text-slate-600">Glucose 5%: Ù„Ù„Ø¬ÙØ§Ù Ø§Ù„Ø®Ù„ÙˆÙŠ (Hypernatremia).</span>
                </div>
                <div className="p-3 bg-red-50 rounded-lg border border-red-100">
                  <span className="font-bold text-red-700 block mb-1">Hypertonic (Ù…Ø±ÙƒØ²)</span>
                  <span className="text-slate-600">Mannitol: Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ÙŠØ§Ù‡ Ù…Ù† Ø§Ù„Ù…Ø® (Edema).</span>
                </div>
              </div>
            </Card>
          </div>
        );

      case 'notes':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <SectionTitle icon={StickyNote} title="Ù†ÙˆØª Ø¨ÙˆÙƒ Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø©" color="text-slate-600" />
            
            <div className="relative">
              <textarea 
                className="w-full h-64 p-4 rounded-2xl border-2 border-slate-200 focus:border-purple-500 focus:outline-none resize-none bg-yellow-50 text-slate-700 leading-relaxed shadow-inner"
                placeholder="Ø§ÙƒØªØ¨ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§... (Ù‡ØªØªØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ)"
                value={notes}
                onChange={(e) => setNotes(e.target.value)}
              />
              <div className="absolute top-4 left-4 text-slate-300 pointer-events-none">
                <StickyNote size={24} />
              </div>
            </div>
            
            <button 
              onClick={handleSaveNotes}
              className="w-full py-4 bg-emerald-600 text-white rounded-2xl font-bold text-lg shadow-lg hover:bg-emerald-700 transition flex items-center justify-center gap-2"
            >
              <Save size={20} /> Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            </button>
            
            {showSaveMsg && (
              <div className="text-center text-emerald-600 font-bold animate-pulse">
                ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ…
              </div>
            )}
          </div>
        );

      default: // Home
        return (
          <div className="grid grid-cols-3 gap-4 p-2 animate-in fade-in zoom-in duration-300">
            {[
              { id: 'drugs', label: 'Ø£Ø¯ÙˆÙŠØ©', icon: Pill, color: 'text-purple-600', bg: 'bg-purple-50' },
              { id: 'study', label: 'Ø¯Ø±Ø§Ø³Ø©', icon: GraduationCap, color: 'text-blue-600', bg: 'bg-blue-50' },
              { id: 'emergency', label: 'Ø·ÙˆØ§Ø±Ø¦', icon: HeartPulse, color: 'text-red-600', bg: 'bg-red-50' },
              { id: 'labs', label: 'ØªØ­Ø§Ù„ÙŠÙ„', icon: Microscope, color: 'text-teal-600', bg: 'bg-teal-50' },
              { id: 'calcs', label: 'Ø­Ø§Ø³Ø¨Ø§Øª', icon: Calculator, color: 'text-indigo-600', bg: 'bg-indigo-50' },
              { id: 'nursing', label: 'ØªÙ…Ø±ÙŠØ¶', icon: Syringe, color: 'text-sky-600', bg: 'bg-sky-50' },
              { id: 'notes', label: 'Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ', icon: StickyNote, color: 'text-slate-600', bg: 'bg-slate-50' },
            ].map((cat) => (
              <div 
                key={cat.id}
                onClick={() => setActiveTab(cat.id)}
                className={`flex flex-col items-center justify-center p-4 rounded-2xl shadow-sm border border-slate-100 cursor-pointer transition-all hover:scale-105 active:scale-95 bg-white`}
              >
                <div className={`p-3 rounded-full mb-2 ${cat.bg}`}>
                  <cat.icon size={24} className={cat.color} />
                </div>
                <span className="text-sm font-bold text-slate-700">{cat.label}</span>
              </div>
            ))}
          </div>
        );
    }
  };

  const ZapIcon = ({ className, size }) => (
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      width={size} 
      height={size} 
      viewBox="0 0 24 24" 
      fill="none" 
      stroke="currentColor" 
      strokeWidth="2" 
      strokeLinecap="round" 
      strokeLinejoin="round" 
      className={className}
    >
      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
    </svg>
  );

  return (
    <div className="min-h-screen bg-slate-50 font-sans dir-rtl text-slate-800 pb-24" dir="rtl">
      {/* Hero Section */}
      <div className="relative bg-gradient-to-br from-purple-700 to-indigo-800 text-white rounded-b-[3rem] shadow-xl overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/medical-icons.png')]"></div>
        <div className="relative px-6 pt-12 pb-16 text-center">
          <h1 className="text-3xl font-extrabold mb-2 tracking-tight">Dr. Bibo Universe â™¾ï¸</h1>
          <p className="text-purple-200 text-sm font-medium">ÙƒÙ„ Ø³Ù†Ø© ÙˆØ§Ù†ØªÙŠ Ø·ÙŠØ¨Ø© ÙŠØ§ Ø¯ÙƒØªÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ â¤ï¸</p>
        </div>
      </div>

      {/* Search Bar - Floating */}
      <div className="px-6 -mt-7 relative z-10 mb-6">
        <div className="relative shadow-lg rounded-full">
          <input 
            type="text" 
            placeholder="ğŸ” Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø¯ÙˆØ§Ø¡ØŒ Ø¹Ø±Ø¶ØŒ Ø£Ùˆ ØªØ­Ù„ÙŠÙ„..." 
            className="w-full py-4 pr-14 pl-6 rounded-full border-none focus:ring-4 focus:ring-purple-200 outline-none text-slate-700 font-medium shadow-sm transition-all"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
          <div className="absolute top-1/2 right-4 -translate-y-1/2 text-purple-600">
            {searchQuery ? (
              <X className="cursor-pointer hover:bg-slate-100 rounded-full p-1" onClick={() => setSearchQuery('')} />
            ) : null}
          </div>
        </div>
      </div>

      {/* Main Content Area */}
      <div className="px-4 max-w-2xl mx-auto">
        {activeTab !== 'home' && (
          <button 
            onClick={() => setActiveTab('home')}
            className="mb-4 text-sm text-slate-500 flex items-center gap-1 hover:text-purple-600 transition-colors"
          >
            <ChevronLeft size={16} /> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </button>
        )}
        {renderContent()}
      </div>

      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] rounded-t-3xl z-50 px-6 py-2">
        <div className="flex justify-between items-center max-w-md mx-auto">
          {[
            { id: 'drugs', icon: Pill, label: 'Ø£Ø¯ÙˆÙŠØ©' },
            { id: 'nursing', icon: Syringe, label: 'ØªÙ…Ø±ÙŠØ¶' },
            { id: 'home', icon: Stethoscope, label: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', main: true },
            { id: 'calcs', icon: Calculator, label: 'Ø­Ø§Ø³Ø¨Ø©' },
            { id: 'emergency', icon: HeartPulse, label: 'Ø·ÙˆØ§Ø±Ø¦' },
          ].map((item) => (
            <button
              key={item.id}
              onClick={() => {
                setActiveTab(item.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }}
              className={`flex flex-col items-center justify-center p-2 transition-all duration-300 ${
                activeTab === item.id ? 'text-purple-600 -translate-y-2' : 'text-slate-400 hover:text-slate-600'
              } ${item.main ? 'bg-purple-50 rounded-full p-3 -mt-6 border-4 border-white shadow-lg' : ''}`}
            >
              <item.icon size={item.main ? 28 : 22} className={activeTab === item.id ? 'animate-bounce-subtle' : ''} />
              {!item.main && <span className="text-[10px] font-bold mt-1">{item.label}</span>}
            </button>
          ))}
        </div>
      </div>

      {/* Drug Modal Detail */}
      {selectedDrug && (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-200">
          <div className="bg-white rounded-3xl w-full max-w-md shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200">
            <div className="bg-gradient-to-r from-purple-600 to-indigo-600 p-6 text-white relative">
              <button 
                onClick={() => setSelectedDrug(null)}
                className="absolute top-4 left-4 p-2 bg-white/20 rounded-full hover:bg-white/30 transition"
              >
                <X size={20} />
              </button>
              <h2 className="text-2xl font-bold mb-1">{selectedDrug.name}</h2>
              <p className="opacity-90 font-mono text-sm">{selectedDrug.generic}</p>
            </div>
            
            <div className="p-6 space-y-5">
              <div>
                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
                <div className="text-slate-800 font-semibold text-lg leading-relaxed">
                  {selectedDrug.use}
                </div>
              </div>
              
              <div>
                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©</label>
                <div className="inline-block bg-indigo-50 text-indigo-700 px-4 py-2 rounded-xl font-bold border border-indigo-100">
                  {selectedDrug.dose}
                </div>
              </div>

              <div className="bg-amber-50 border-r-4 border-amber-500 p-4 rounded-r-lg">
                <div className="flex gap-2 text-amber-800 font-bold mb-1">
                  <AlertTriangle size={18} /> ØªØ­Ø°ÙŠØ±
                </div>
                <p className="text-sm text-amber-700 leading-relaxed">
                  {selectedDrug.warn}
                </p>
              </div>
            </div>

            <div className="p-4 bg-slate-50 border-t border-slate-100 text-center">
              <button 
                onClick={() => setSelectedDrug(null)}
                className="w-full py-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-600 hover:bg-slate-100 transition"
              >
                Ø¥ØºÙ„Ø§Ù‚
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Custom Styles */}
      <style>{`
        .animate-bounce-subtle {
          animation: bounce-subtle 2s infinite;
        }
        @keyframes bounce-subtle {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-3px); }
        }
      `}</style>
    </div>
  );
}